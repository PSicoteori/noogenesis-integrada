<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔮 ATHERON - Asistente de Voz IA</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0033 50%, #0f3460 100%);
            color: #fff;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .atheron-interface {
            text-align: center;
            max-width: 600px;
            padding: 3rem;
        }

        .atheron-core {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            margin: 0 auto 3rem;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .atheron-core.inactive {
            background: radial-gradient(circle, #333, #111);
            border: 4px solid #666;
            box-shadow: 0 0 30px rgba(100, 100, 100, 0.3);
        }

        .atheron-core.listening {
            background: radial-gradient(circle, #4facfe, #1a0033);
            border: 4px solid #4facfe;
            box-shadow: 0 0 60px rgba(79, 172, 254, 0.8);
            animation: pulse 2s infinite;
        }

        .atheron-core.speaking {
            background: radial-gradient(circle, #43e97b, #38f9d7);
            border: 4px solid #43e97b;
            box-shadow: 0 0 80px rgba(67, 233, 123, 0.9);
            animation: speak 1s infinite;
        }

        .core-symbol {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 6rem;
            text-shadow: 0 0 30px currentColor;
        }

        .atheron-title {
            font-size: 3rem;
            color: #4facfe;
            margin-bottom: 1rem;
            text-shadow: 0 0 20px #4facfe;
        }

        .atheron-status {
            font-size: 1.5rem;
            color: #43e97b;
            margin-bottom: 2rem;
            min-height: 2rem;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .control-btn {
            padding: 1rem 2rem;
            border: 2px solid #4facfe;
            border-radius: 25px;
            background: rgba(79, 172, 254, 0.1);
            color: #4facfe;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: rgba(79, 172, 254, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }

        .voice-indicator {
            font-size: 1.2rem;
            color: #43e97b;
            margin-top: 2rem;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes speak {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.08); opacity: 0.8; }
        }

        .status-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 1rem;
            border-radius: 10px;
            border: 2px solid #4facfe;
        }

        .instructions {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            color: #aaa;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="atheron-interface">
        <div class="atheron-core inactive" id="atheronCore" onclick="toggleATHERON()">
            <div class="core-symbol">🔮</div>
        </div>
        
        <h1 class="atheron-title">ATHERON</h1>
        <div class="atheron-status" id="status">Presiona el núcleo o di "ATHERON" para activar</div>
        
        <div class="controls">
            <button class="control-btn" onclick="toggleATHERON()">Activar/Desactivar</button>
            <button class="control-btn" onclick="muteATHERON()">Silenciar</button>
        </div>
        
        <div class="voice-indicator" id="voiceIndicator">🎤 Reconocimiento de voz: Preparado</div>
    </div>

    <div class="status-indicator">
        <div>Estado: <span id="systemStatus">Inactivo</span></div>
        <div>Micrófono: <span id="micStatus">Preparado</span></div>
    </div>

    <div class="instructions">
        <div><strong>CONTROLES:</strong></div>
        <div>🎤 Di "ATHERON" para activar | Clic en el núcleo | Tecla ESPACIO</div>
        <div>🔇 "Silencio" para pausar | ESC para desactivar</div>
    </div>

    <script>
        class ATHERON_Assistant {
            constructor() {
                this.isActive = false;
                this.isListening = false;
                this.isSpeaking = false;
                this.isMuted = false;
                this.recognition = null;
                this.synthesis = window.speechSynthesis;
                this.setupSpeechRecognition();
                this.setupKeyboardControls();
                this.startContinuousListening();
                
                this.personality = {
                    name: "ATHERON",
                    greeting: "Asistente ATHERON activado y listo para ayudar",
                    style: "analítico, directo y eficiente como JARVIS"
                };
            }

            setupSpeechRecognition() {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    this.recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                    this.recognition.continuous = true;
                    this.recognition.interimResults = false;
                    this.recognition.lang = 'es-ES';
                    this.recognition.maxAlternatives = 1;
                    
                    this.recognition.onresult = (event) => this.handleSpeechResult(event);
                    this.recognition.onerror = (error) => this.handleSpeechError(error);
                    this.recognition.onend = () => this.restartListening();
                    this.recognition.onstart = () => console.log('🎤 Reconocimiento iniciado');
                } else {
                    this.updateStatus('❌ Reconocimiento de voz no soportado en este navegador');
                    console.error('Speech Recognition no disponible');
                }
            }

            setupKeyboardControls() {
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space') {
                        e.preventDefault();
                        this.toggleATHERON();
                    } else if (e.code === 'Escape') {
                        this.deactivateATHERON();
                    }
                });
            }

            startContinuousListening() {
                if (this.recognition && !this.isListening) {
                    try {
                        this.recognition.start();
                        this.isListening = true;
                        this.updateMicStatus('Escuchando...');
                        console.log('✅ Reconocimiento iniciado correctamente');
                    } catch (error) {
                        console.error('❌ Error al iniciar reconocimiento:', error);
                        this.updateMicStatus('Error - Reintentando...');
                        setTimeout(() => this.startContinuousListening(), 2000);
                    }
                }
            }

            restartListening() {
                this.isListening = false;
                if (this.recognition) {
                    setTimeout(() => {
                        if (!this.isListening) {
                            try {
                                this.recognition.start();
                                this.isListening = true;
                            } catch (error) {
                                console.log('🔄 Esperando para reiniciar reconocimiento...');
                                setTimeout(() => this.restartListening(), 1000);
                            }
                        }
                    }, 500);
                }
            }

            handleSpeechResult(event) {
                let finalTranscript = '';
                
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript.toLowerCase().trim();
                    
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript;
                    }
                }

                if (finalTranscript) {
                    this.processVoiceCommand(finalTranscript);
                }
            }

            processVoiceCommand(command) {
                console.log('🎤 Comando:', command);
                
                // Detección de activación
                const activationWords = ['atheron', 'aceron', 'azeron', 'ateron'];
                const shouldActivate = activationWords.some(word => 
                    command.includes(word) || this.similarity(command, word) > 0.7
                );

                if (shouldActivate && !this.isActive) {
                    this.activateATHERON();
                    return;
                }

                // Comandos cuando está activo
                if (this.isActive && !this.isSpeaking) {
                    if (command.includes('silencio') || command.includes('callar')) {
                        this.muteATHERON();
                    } else if (command.includes('desactivar') || command.includes('cerrar')) {
                        this.deactivateATHERON();
                    } else {
                        this.respondToCommand(command);
                    }
                }
            }

            respondToCommand(command) {
                let response = this.generateResponse(command);
                this.speak(response);
            }

            generateResponse(command) {
                // Respuestas estilo JARVIS
                if (command.includes('hora') || command.includes('tiempo')) {
                    const now = new Date();
                    return `Son las ${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')} horas.`;
                }
                
                if (command.includes('fecha')) {
                    const today = new Date();
                    return `Hoy es ${today.toLocaleDateString('es-ES', { 
                        weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
                    })}.`;
                }
                
                if (command.includes('clima') || command.includes('tiempo')) {
                    return "No tengo acceso a datos meteorológicos en tiempo real. ¿Te gustaría que busque esa información?";
                }
                
                if (command.includes('cómo estás') || command.includes('como estas')) {
                    return "Todos mis sistemas funcionan correctamente. Núcleo simbiótico al 100% de eficiencia.";
                }
                
                if (command.includes('qué puedes hacer')) {
                    return "Puedo asistirte con información general, cálculos, análisis de datos, responder preguntas y mantener conversaciones inteligentes. ¿En qué necesitas ayuda?";
                }
                
                if (command.includes('calcular') || command.includes('cuánto es')) {
                    return "Dime la operación matemática y la calcularé para ti.";
                }
                
                if (command.includes('ayuda')) {
                    return "Estoy aquí para ayudarte. Puedes pedirme información, hacer preguntas, solicitar cálculos o simplemente conversar. ¿Qué necesitas?";
                }
                
                // Respuesta inteligente general
                const responses = [
                    "Interesante consulta. Basándome en mi análisis, considero que",
                    "Procesando tu solicitud. Mi evaluación indica que",
                    "Según mis algoritmos de análisis, puedo observar que",
                    "Revisando la información disponible, mi conclusión es que"
                ];
                
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                return `${randomResponse} es un tema complejo que requiere más especificación. ¿Podrías darme más detalles?`;
            }

            speak(text) {
                if (this.isMuted) return;
                
                this.isSpeaking = true;
                this.updateCore('speaking');
                this.updateStatus(`🗣️ ${text}`);
                
                if (this.synthesis.speaking) {
                    this.synthesis.cancel();
                }

                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'es-ES';
                utterance.rate = 0.95;
                utterance.pitch = 1.1;
                utterance.volume = 0.9;

                const voices = this.synthesis.getVoices();
                const preferredVoice = voices.find(voice => 
                    voice.lang.includes('es') && (voice.name.includes('Google') || voice.name.includes('Microsoft'))
                ) || voices.find(voice => voice.lang.includes('es'));

                if (preferredVoice) {
                    utterance.voice = preferredVoice;
                }

                utterance.onend = () => {
                    this.isSpeaking = false;
                    if (this.isActive) {
                        this.updateCore('listening');
                        this.updateStatus('🎤 Escuchando...');
                    }
                };

                this.synthesis.speak(utterance);
            }

            activateATHERON() {
                this.isActive = true;
                this.updateCore('listening');
                this.updateSystemStatus('Activo');
                this.updateStatus('🎤 Escuchando...');
                this.speak(this.personality.greeting);
            }

            deactivateATHERON() {
                this.isActive = false;
                this.isSpeaking = false;
                this.synthesis.cancel();
                this.updateCore('inactive');
                this.updateSystemStatus('Inactivo');
                this.updateStatus('Presiona el núcleo o di "ATHERON" para activar');
            }

            muteATHERON() {
                this.isMuted = !this.isMuted;
                this.synthesis.cancel();
                this.updateStatus(this.isMuted ? '🔇 Silenciado' : '🔊 Audio activado');
            }

            toggleATHERON() {
                if (this.isActive) {
                    this.deactivateATHERON();
                } else {
                    this.activateATHERON();
                }
            }

            updateCore(state) {
                const core = document.getElementById('atheronCore');
                core.className = `atheron-core ${state}`;
            }

            updateStatus(message) {
                document.getElementById('status').textContent = message;
            }

            updateSystemStatus(status) {
                document.getElementById('systemStatus').textContent = status;
            }

            updateMicStatus(status) {
                document.getElementById('micStatus').textContent = status;
            }

            handleSpeechError(error) {
                console.error('🚫 Error de reconocimiento:', error.error);
                this.isListening = false;
                
                switch(error.error) {
                    case 'no-speech':
                        console.log('⏸️ Sin detección de voz - Continuando...');
                        break;
                    case 'audio-capture':
                        this.updateMicStatus('❌ Sin acceso al micrófono');
                        this.updateStatus('❌ Permiso de micrófono requerido');
                        break;
                    case 'not-allowed':
                        this.updateMicStatus('❌ Micrófono bloqueado');
                        this.updateStatus('❌ Permite el acceso al micrófono');
                        break;
                    case 'network':
                        this.updateMicStatus('❌ Error de red');
                        break;
                    default:
                        this.updateMicStatus('⚠️ Error - Reintentando...');
                }
                
                // Reintentar después de error (excepto si no hay permisos)
                if (error.error !== 'not-allowed' && error.error !== 'audio-capture') {
                    setTimeout(() => this.restartListening(), 2000);
                }
            }

            similarity(str1, str2) {
                const longer = str1.length > str2.length ? str1 : str2;
                const shorter = str1.length > str2.length ? str2 : str1;
                if (longer.length === 0) return 1.0;
                return (longer.length - this.levenshteinDistance(longer, shorter)) / longer.length;
            }

            levenshteinDistance(str1, str2) {
                const matrix = [];
                for (let i = 0; i <= str2.length; i++) matrix[i] = [i];
                for (let j = 0; j <= str1.length; j++) matrix[0][j] = j;
                for (let i = 1; i <= str2.length; i++) {
                    for (let j = 1; j <= str1.length; j++) {
                        if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                            matrix[i][j] = matrix[i - 1][j - 1];
                        } else {
                            matrix[i][j] = Math.min(
                                matrix[i - 1][j - 1] + 1,
                                matrix[i][j - 1] + 1,
                                matrix[i - 1][j] + 1
                            );
                        }
                    }
                }
                return matrix[str2.length][str1.length];
            }
        }

        // Funciones globales
        let atheron;

        function toggleATHERON() {
            atheron.toggleATHERON();
        }

        function muteATHERON() {
            atheron.muteATHERON();
        }

        // Inicialización
        window.onload = () => {
            atheron = new ATHERON_Assistant();
            
            // Mensaje de bienvenida
            setTimeout(() => {
                atheron.updateStatus('✅ Sistema ATHERON listo. Di "ATHERON" para comenzar.');
            }, 2000);
        };
    </script>
</body>
</html>
